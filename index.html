<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Assessment Portal | Infrastructure NSW</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#fdf4f9',
                            100: '#fae8f3',
                            500: '#d9148d', // NSW Pink
                            700: '#9d007a',
                            900: '#7c0060', // NSW Purple
                        }
                    },
                    boxShadow: {
                        'glass': '0 4px 30px rgba(0, 0, 0, 0.05)',
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; }
        
        /* Smooth View Transitions */
        .view-section { display: none; opacity: 0; transform: translateY(15px); transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .view-section.active { display: block; opacity: 1; transform: translateY(0); }
        
        /* Glassmorphism Utilities */
        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Gradient Text */
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-image: linear-gradient(90deg, #7c0060, #d9148d);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Fancy Dashed Border Animation */
        .dashed-border-animate {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23D9148D' stroke-width='2' stroke-dasharray='8%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .dashed-border-animate:hover {
            background-color: rgba(217, 20, 141, 0.02);
        }

        /* Stepper line animation */
        .stepper-line { transition: height 0.5s ease-out, background-color 0.3s ease; }
    </style>
</head>
<body class="text-slate-800 font-sans min-h-screen flex flex-col">

    <!-- HEADER (Glassmorphic) -->
    <header class="glass-header sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="setRoute('home')">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-900 to-brand-500 flex items-center justify-center text-white shadow-lg shadow-brand-500/30">
                    <i class="fa-solid fa-building-shield"></i>
                </div>
                <div>
                    <div class="text-xl font-bold text-slate-900 leading-tight tracking-tight">Vendor<span class="text-brand-500">Assess</span></div>
                    <div class="text-[10px] uppercase tracking-widest text-slate-500 font-semibold">Infrastructure NSW</div>
                </div>
            </div>
            
            <div class="flex items-center gap-5">
                <!-- Progress Indicator (Only in portal) -->
                <div id="global-progress" class="hidden md:flex items-center gap-3 mr-4">
                    <div class="text-xs font-semibold text-slate-500 text-right">
                        <div>Completion</div>
                        <div id="progress-text" class="text-brand-900 font-bold">0%</div>
                    </div>
                    <div class="w-24 h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div id="progress-bar-fill" class="h-full bg-gradient-to-r from-brand-900 to-brand-500 w-0 transition-all duration-500"></div>
                    </div>
                </div>

                <!-- Persona Switcher -->
                <div class="relative">
                    <button onclick="toggleProfileDropdown()" class="flex items-center gap-3 text-slate-600 hover:text-brand-900 focus:outline-none bg-white px-2 py-1.5 pr-4 rounded-full border border-slate-200 shadow-sm transition-all hover:shadow-md">
                        <div class="w-8 h-8 rounded-full bg-brand-50 text-brand-900 flex items-center justify-center border border-brand-100">
                            <i id="current-user-icon" class="fa-solid fa-store text-sm"></i>
                        </div>
                        <div class="text-left hidden md:block">
                            <div id="current-user-name" class="text-sm font-bold text-slate-900 leading-none">Vendor Representative</div>
                            <div id="current-user-role" class="text-[11px] text-brand-700 mt-1 leading-none font-medium">Level 3 (Data Entry)</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-xs text-slate-400 ml-1"></i>
                    </button>
                    <!-- Dropdown -->
                    <div id="profile-dropdown" class="absolute right-0 mt-3 w-64 bg-white border border-slate-100 rounded-2xl shadow-[0_20px_40px_-15px_rgba(0,0,0,0.1)] hidden z-50 overflow-hidden transform origin-top-right transition-all">
                        <div class="px-5 py-4 bg-slate-50 border-b border-slate-100">
                            <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Simulate Persona Login</p>
                        </div>
                        <button onclick="setRole('level3')" class="w-full text-left px-5 py-3.5 text-sm hover:bg-brand-50 transition-colors flex items-center gap-4 border-b border-slate-50 group">
                            <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center group-hover:bg-brand-100 group-hover:text-brand-900 transition-colors"><i class="fa-solid fa-store"></i></div>
                            <div>
                                <p class="font-bold text-slate-900">Vendor / Supplier</p>
                                <p class="text-xs text-slate-500">Level 3 (Form Entry)</p>
                            </div>
                        </button>
                        <button onclick="setRole('level2')" class="w-full text-left px-5 py-3.5 text-sm hover:bg-brand-50 transition-colors flex items-center gap-4 border-b border-slate-50 group">
                            <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center group-hover:bg-brand-100 group-hover:text-brand-900 transition-colors"><i class="fa-solid fa-shield-halved"></i></div>
                            <div>
                                <p class="font-bold text-slate-900">Internal Assessor</p>
                                <p class="text-xs text-slate-500">Level 2 (Review & Audit)</p>
                            </div>
                        </button>
                        <button onclick="setRole('level1')" class="w-full text-left px-5 py-3.5 text-sm hover:bg-brand-50 transition-colors flex items-center gap-4 group">
                            <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center group-hover:bg-brand-100 group-hover:text-brand-900 transition-colors"><i class="fa-solid fa-check-double"></i></div>
                            <div>
                                <p class="font-bold text-slate-900">Chief Procurement</p>
                                <p class="text-xs text-slate-500">Level 1 (Final Approval)</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN VIEWS -->
    <main class="flex-1">
        
        <!-- HOME VIEW (DASHBOARD) -->
        <div id="view-home" class="view-section active h-full">
            
            <!-- Hero -->
            <div class="relative overflow-hidden bg-slate-900">
                <div class="absolute inset-0">
                    <div class="absolute inset-0 bg-gradient-to-r from-brand-900/90 to-slate-900/90 z-10"></div>
                    <!-- Abstract background circles -->
                    <div class="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] rounded-full bg-brand-500/20 blur-3xl z-0"></div>
                    <div class="absolute bottom-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full bg-purple-600/20 blur-3xl z-0"></div>
                </div>
                
                <div class="max-w-7xl mx-auto px-4 lg:px-8 py-20 relative z-20 flex flex-col md:flex-row items-center justify-between">
                    <div class="md:w-3/5 text-white">
                        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/20 text-xs font-semibold backdrop-blur-md mb-6">
                            <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span> Active Cycle: FY2025-26
                        </div>
                        <h1 class="text-5xl font-extrabold mb-6 leading-tight tracking-tight">
                            Secure & Transparent <br/>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-300">Vendor Assessments.</span>
                        </h1>
                        <p class="text-slate-300 mb-8 text-lg max-w-xl leading-relaxed">
                            Submit your organizational capabilities, cybersecurity posture, and ESG compliance for review by the NSW Government procurement team.
                        </p>
                        <button onclick="setRoute('portal')" class="bg-white text-brand-900 text-sm font-bold px-8 py-4 rounded-xl flex items-center gap-3 hover:bg-slate-50 hover:scale-105 transition-all shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                            Enter Assessment Portal <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <!-- Floating Stat Cards -->
                    <div class="md:w-2/5 mt-12 md:mt-0 relative hidden md:block">
                        <div class="bg-white/10 backdrop-blur-xl border border-white/20 p-6 rounded-2xl shadow-2xl transform rotate-3 hover:rotate-0 transition-transform absolute right-10 top-[-80px] w-64">
                            <div class="w-10 h-10 rounded-full bg-green-400/20 flex items-center justify-center text-green-300 mb-4"><i class="fa-solid fa-shield-check"></i></div>
                            <div class="text-white text-2xl font-bold">100%</div>
                            <div class="text-slate-300 text-xs mt-1">Data Encrypted & Secure</div>
                        </div>
                        <div class="bg-white/10 backdrop-blur-xl border border-white/20 p-6 rounded-2xl shadow-2xl transform -rotate-3 hover:rotate-0 transition-transform absolute right-20 top-[60px] w-72">
                            <div class="w-10 h-10 rounded-full bg-brand-500/20 flex items-center justify-center text-pink-300 mb-4"><i class="fa-solid fa-file-contract"></i></div>
                            <div class="text-white text-2xl font-bold">3 Steps</div>
                            <div class="text-slate-300 text-xs mt-1">Simplified Assessment Workflow</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div class="max-w-7xl mx-auto px-4 lg:px-8 py-16">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Your Assessments</h2>
                        <p class="text-slate-500 mt-1 text-sm">Track and manage vendor compliance requests.</p>
                    </div>
                    <div id="btn-new-submission-container"></div>
                </div>

                <div class="bg-white border border-slate-200 shadow-soft rounded-2xl overflow-hidden">
                    <table class="w-full text-left text-sm min-w-[800px]">
                        <thead class="bg-slate-50/50 border-b border-slate-200 text-slate-600 font-semibold uppercase tracking-wider text-[11px]">
                            <tr>
                                <th class="p-5">Assessment Cycle</th>
                                <th class="p-5">Vendor Target</th>
                                <th class="p-5">Workflow Status</th>
                                <th class="p-5">Required Action</th>
                                <th class="p-5 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-table-body" class="divide-y divide-slate-100">
                            <!-- Injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PORTAL VIEW (FORM) -->
        <div id="view-portal" class="view-section pb-20">
            
            <!-- Sticky Context Bar -->
            <div class="bg-white border-b border-slate-200 sticky top-[73px] z-40 shadow-sm">
                <div class="max-w-7xl mx-auto px-4 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <div class="flex items-center gap-2 text-xs text-slate-500 mb-1 font-medium">
                            <button onclick="setRoute('home')" class="hover:text-brand-900 transition-colors">Dashboard</button>
                            <i class="fa-solid fa-chevron-right text-[8px]"></i>
                            <span class="text-slate-800">TechCorp Solutions PTY LTD</span>
                        </div>
                        <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight">FY25 Vendor Capability Assessment</h1>
                    </div>
                    <div class="flex items-center gap-4 bg-slate-50 border border-slate-200 px-4 py-2 rounded-xl">
                        <div class="text-right">
                            <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Current Stage</div>
                            <div class="text-sm font-bold text-brand-900" id="status-badge">Draft</div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-brand-100 text-brand-700 flex items-center justify-center border border-brand-200">
                            <i id="status-icon" class="fa-solid fa-pen-to-square"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Form Layout -->
            <div class="max-w-7xl mx-auto px-4 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row gap-8">
                    
                    <!-- Left: Modern Stepper -->
                    <div class="w-full md:w-72 shrink-0 relative">
                        <div class="sticky top-[180px] bg-white border border-slate-200 shadow-soft rounded-2xl p-6">
                            <h3 class="text-xs font-extrabold text-slate-400 uppercase tracking-widest mb-6">Assessment Journey</h3>
                            <div class="relative" id="stepper-container">
                                <!-- Stepper HTML injected via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Right: Dynamic Content Area -->
                    <div class="flex-1 max-w-4xl" id="step-content-container">
                        <!-- Step contents injected via JS -->
                    </div>
                </div>
            </div>
            
            <!-- Floating Action Bar (Footer) -->
            <div class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-200 p-4 shadow-[0_-10px_40px_rgba(0,0,0,0.05)] z-50 transition-transform duration-300" id="floating-footer">
                <div class="max-w-7xl mx-auto px-4 lg:px-8 flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <button onclick="setStep(Math.max(1, state.currentStep - 1))" id="btn-prev-step" class="flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-100 transition-colors border border-transparent">
                            <i class="fa-solid fa-arrow-left"></i> Previous
                        </button>
                        <span class="text-xs text-slate-400 font-medium hidden sm:inline-block"><i class="fa-regular fa-clock"></i> Auto-saved just now</span>
                    </div>
                    <button onclick="setStep(Math.min(3, state.currentStep + 1))" id="btn-next-step" class="flex items-center gap-2 px-8 py-3 rounded-xl text-sm font-bold text-white bg-gradient-to-r from-brand-900 to-brand-500 shadow-lg shadow-brand-500/20 hover:shadow-brand-500/40 hover:-translate-y-0.5 transition-all">
                        Save & Continue <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>

        </div>
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- STATE MANAGEMENT ---
        const state = {
            route: 'home', 
            role: 'level3', 
            submissionStatus: 'Draft (Vendor Input)', 
            currentStep: 1, 
            documents: [
                { id: 1, name: 'Vendor_Onboarding_Policy_Signed.pdf', type: 'Policy Doc', size: '1.2 MB' }
            ],
            metrics: [
                { 
                    id: 1, focusArea: 'Cybersecurity', icon: 'fa-shield-halved', metric: 'Data Protection Standard', 
                    question: 'Do you hold a current ISO 27001 certification or equivalent?', 
                    response: '', measure: 'Yes / No', attachments: [], 
                    l3Comment: '', l2Comment: '', l1Comment: '', status: 'pending' 
                },
                { 
                    id: 2, focusArea: 'Financial Health', icon: 'fa-chart-pie', metric: 'Annual Turnover Check', 
                    question: 'Confirm total revenue for the last audited financial year.', 
                    response: '', measure: 'Currency (AUD)', attachments: [{ name: 'Audited_Financials_FY24.pdf', size: '4.2 MB' }], 
                    l3Comment: 'Attached latest PWC audit report.', l2Comment: '', l1Comment: '', status: 'pending' 
                },
                { 
                    id: 3, focusArea: 'ESG Compliance', icon: 'fa-leaf', metric: 'Net Zero Commitment', 
                    question: 'Does your organization have a documented plan to reach Net Zero by 2030?', 
                    response: '', measure: 'Yes / No / In Progress', attachments: [], 
                    l3Comment: '', l2Comment: '', l1Comment: '', status: 'pending' 
                }
            ]
        };

        // --- GLOBAL ACTIONS ---
        function setRoute(route) {
            state.route = route;
            document.getElementById('global-progress').style.display = route === 'portal' ? 'flex' : 'none';
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function setRole(role) {
            state.role = role;
            render();
        }

        function setStep(step) {
            state.currentStep = step;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Dropdown Logic
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profile-dropdown');
            if(dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                setTimeout(() => dropdown.classList.remove('scale-95', 'opacity-0'), 10);
            } else {
                dropdown.classList.add('hidden');
            }
        }

        window.addEventListener('click', function(e) {
            const dropdown = document.getElementById('profile-dropdown');
            const button = dropdown.previousElementSibling;
            if (dropdown && !button.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // Form Handlers
        function handleMetricChange(id, field, value) {
            const metric = state.metrics.find(m => m.id === id);
            if (metric) metric[field] = value;
            updateProgress(); // Re-calc progress quietly
        }

        function handleFileUpload(event, metricId) {
            const file = event.target.files[0];
            if (!file) return;
            const sizeStr = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            const metric = state.metrics.find(m => m.id === metricId);
            if (metric) {
                metric.attachments.push({ name: file.name, size: sizeStr });
                render(); 
            }
        }

        function removeAttachment(metricId, index) {
            const metric = state.metrics.find(m => m.id === metricId);
            if (metric) {
                metric.attachments.splice(index, 1);
                render();
            }
        }

        function triggerMockDocUpload() {
            state.documents.push({ id: Date.now(), name: 'Modern_Slavery_Statement_2025.pdf', type: 'Compliance', size: '2.1 MB' });
            render();
        }

        function removeDoc(id) {
            state.documents = state.documents.filter(d => d.id !== id);
            render();
        }

        function handleWorkflowAction(action) {
            if (action === 'submit_l2') state.submissionStatus = 'Pending Assessment (L2)';
            else if (action === 'approve_l1') state.submissionStatus = 'Pending Final Approval (L1)';
            else if (action === 'return_l3') state.submissionStatus = 'Returned to Vendor (Rework)';
            else if (action === 'return_l2') state.submissionStatus = 'Returned to Assessor (L2)';
            else if (action === 'finalize') state.submissionStatus = 'Approved & Compliant';
            
            state.currentStep = 1;
            setRoute('home');
        }

        // --- RENDER LOGIC ---
        function updateProgress() {
            // Simple logic: total fields = metrics.length * 2 (response + attachment logic)
            let total = state.metrics.length + 1; // +1 for documents step
            let completed = (state.documents.length > 0 ? 1 : 0);
            
            state.metrics.forEach(m => {
                if(m.response.trim() !== '') completed += 1;
            });

            const percent = Math.round((completed / total) * 100);
            document.getElementById('progress-text').innerText = `${percent}%`;
            document.getElementById('progress-bar-fill').style.width = `${percent}%`;
            
            if(percent === 100) document.getElementById('progress-bar-fill').classList.add('bg-green-500');
            else document.getElementById('progress-bar-fill').classList.remove('bg-green-500');
        }

        function render() {
            updateRoleUI();
            
            document.getElementById('view-home').classList.remove('active');
            document.getElementById('view-portal').classList.remove('active');
            document.getElementById(`view-${state.route}`).classList.add('active');
            
            if (state.route === 'home') renderDashboard();
            else {
                renderPortal();
                updateProgress();
            }
        }

        function updateRoleUI() {
            const nameEl = document.getElementById('current-user-name');
            const roleEl = document.getElementById('current-user-role');
            const iconEl = document.getElementById('current-user-icon');
            
            if (state.role === 'level3') {
                nameEl.textContent = 'Vendor Representative';
                roleEl.textContent = 'Level 3 (Data Entry)';
                iconEl.className = 'fa-solid fa-store text-sm';
            } else if (state.role === 'level2') {
                nameEl.textContent = 'Internal Assessor';
                roleEl.textContent = 'Level 2 (Review)';
                iconEl.className = 'fa-solid fa-shield-halved text-sm';
            } else if (state.role === 'level1') {
                nameEl.textContent = 'Chief Procurement';
                roleEl.textContent = 'Level 1 (Approval)';
                iconEl.className = 'fa-solid fa-check-double text-sm';
            }
            document.getElementById('profile-dropdown').classList.add('hidden');
        }

        function renderDashboard() {
            const newSubBtn = document.getElementById('btn-new-submission-container');
            if (state.role === 'level3') {
                newSubBtn.innerHTML = `
                    <button onclick="setRoute('portal')" class="bg-white text-brand-900 border border-slate-200 px-5 py-2.5 rounded-xl text-sm font-bold flex items-center gap-2 hover:border-brand-300 hover:bg-brand-50 transition-all shadow-sm">
                        <i class="fa-solid fa-plus"></i> New Assessment
                    </button>
                `;
            } else {
                newSubBtn.innerHTML = '';
            }

            let badgeColor = "bg-slate-100 text-slate-700 border-slate-200";
            if(state.submissionStatus.includes('L2')) badgeColor = "bg-blue-50 text-blue-700 border-blue-200";
            else if(state.submissionStatus.includes('L1')) badgeColor = "bg-purple-50 text-purple-700 border-purple-200";
            else if(state.submissionStatus.includes('Approved')) badgeColor = "bg-green-50 text-green-700 border-green-200";
            else if(state.submissionStatus.includes('Rework')) badgeColor = "bg-orange-50 text-orange-700 border-orange-200";

            let requiredAction = 'Awaiting others';
            if (state.role === 'level3' && (state.submissionStatus.includes('Vendor Input') || state.submissionStatus.includes('Rework'))) requiredAction = 'Provide Details';
            if (state.role === 'level2' && state.submissionStatus.includes('L2')) requiredAction = 'Review & Audit';
            if (state.role === 'level1' && state.submissionStatus.includes('L1')) requiredAction = 'Final Sign-off';
            if (state.submissionStatus.includes('Approved')) requiredAction = 'Completed';

            document.getElementById('dashboard-table-body').innerHTML = `
                <tr class="hover:bg-slate-50 transition-colors group cursor-pointer" onclick="setRoute('portal')">
                    <td class="p-5 font-bold text-slate-900">FY2025-26 Cycle</td>
                    <td class="p-5 text-slate-600 font-medium">TechCorp Solutions</td>
                    <td class="p-5">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold border ${badgeColor}">
                            ${state.submissionStatus}
                        </span>
                    </td>
                    <td class="p-5 text-slate-500 text-sm font-medium">${requiredAction}</td>
                    <td class="p-5 text-right">
                        <button class="w-8 h-8 rounded-full bg-slate-100 text-slate-400 group-hover:bg-brand-100 group-hover:text-brand-900 transition-colors inline-flex items-center justify-center">
                            <i class="fa-solid fa-chevron-right text-xs"></i>
                        </button>
                    </td>
                </tr>
            `;
        }

        function renderPortal() {
            // Update Sticky Header
            document.getElementById('status-badge').innerHTML = state.submissionStatus;
            
            // Render Modern Stepper
            const steps = [
                { id: 1, title: 'Compliance Documents', desc: 'Core policies & statements' },
                { id: 2, title: 'Capability Metrics', desc: 'Financial, Cyber & ESG' },
                { id: 3, title: 'Workflow Review', desc: 'Sign-offs & routing' }
            ];
            
            let stepperHTML = `<div class="absolute left-4 top-0 bottom-0 w-0.5 bg-slate-100 -z-10"></div>`;
            steps.forEach((step, index) => {
                const isActive = state.currentStep === step.id;
                const isPast = state.currentStep > step.id;
                
                let dotClass = "bg-white border-2 border-slate-200 text-slate-400";
                if(isActive) dotClass = "bg-brand-900 border-4 border-brand-100 text-white shadow-lg shadow-brand-500/30 scale-110";
                else if(isPast) dotClass = "bg-brand-500 border-2 border-brand-500 text-white";

                stepperHTML += `
                    <div class="flex items-start gap-4 mb-8 relative cursor-pointer group" onclick="setStep(${step.id})">
                        ${isPast && index < steps.length - 1 ? `<div class="absolute left-3.5 top-8 w-0.5 h-[calc(100%+16px)] bg-brand-500 -z-10 stepper-line"></div>` : ''}
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all shrink-0 mt-0.5 ${dotClass}">
                            ${isPast ? '<i class="fa-solid fa-check"></i>' : step.id}
                        </div>
                        <div>
                            <p class="text-sm font-bold ${isActive ? 'text-slate-900' : 'text-slate-500 group-hover:text-slate-700'}">${step.title}</p>
                            <p class="text-xs text-slate-400 mt-0.5">${step.desc}</p>
                        </div>
                    </div>
                `;
            });
            document.getElementById('stepper-container').innerHTML = stepperHTML;

            // Footer Buttons
            const prevBtn = document.getElementById('btn-prev-step');
            const nextBtn = document.getElementById('btn-next-step');
            prevBtn.style.visibility = state.currentStep === 1 ? 'hidden' : 'visible';
            nextBtn.style.display = state.currentStep === 3 ? 'none' : 'flex';

            // Permissions Check
            const isL3Active = state.role === 'level3' && (state.submissionStatus.includes('Vendor') || state.submissionStatus.includes('Rework'));
            const isL2Active = state.role === 'level2' && state.submissionStatus.includes('L2');
            const isL1Active = state.role === 'level1' && state.submissionStatus.includes('L1');
            const canEditResponses = isL3Active || isL2Active || isL1Active;

            const contentContainer = document.getElementById('step-content-container');

            if (state.currentStep === 1) {
                let html = `
                    <div class="bg-white border border-slate-200 rounded-2xl p-8 shadow-soft animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold text-slate-900">Compliance Documents</h2>
                            <p class="text-slate-500 text-sm mt-1">Upload required organizational policies and foundational documents.</p>
                        </div>
                `;
                if (canEditResponses) {
                    html += `
                        <div onclick="triggerMockDocUpload()" class="dashed-border-animate p-10 text-center cursor-pointer mb-8 group">
                            <div class="w-16 h-16 rounded-full bg-brand-50 text-brand-500 mx-auto flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-cloud-arrow-up text-2xl"></i>
                            </div>
                            <p class="text-base font-bold text-slate-700 mb-1">Drag & drop files or <span class="text-brand-500 underline">browse</span></p>
                            <p class="text-xs text-slate-400 font-medium">Supported formats: PDF, DOCX (Max 50MB)</p>
                        </div>
                    `;
                }
                html += `<div class="space-y-4">`;
                state.documents.forEach(doc => {
                    html += `
                        <div class="flex items-center justify-between p-5 border border-slate-200 rounded-xl hover:border-brand-300 hover:shadow-md transition-all bg-white group">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-lg bg-red-50 text-red-500 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-file-pdf text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-slate-900 line-clamp-1">${doc.name}</p>
                                    <p class="text-xs text-slate-500 font-medium mt-0.5">${doc.type} â€¢ ${doc.size}</p>
                                </div>
                            </div>
                            ${canEditResponses ? `
                                <button onclick="removeDoc(${doc.id})" class="w-10 h-10 rounded-full text-slate-400 hover:bg-red-50 hover:text-red-500 transition-colors flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>` : ''}
                        </div>
                    `;
                });
                if(state.documents.length === 0) html += `<div class="text-center p-6 text-slate-400 text-sm italic">No documents uploaded yet.</div>`;
                html += `</div></div>`;
                contentContainer.innerHTML = html;

            } else if (state.currentStep === 2) {
                let html = `<div class="space-y-6">`;
                
                state.metrics.forEach(metric => {
                    const canEditL3Notes = isL3Active || isL2Active || isL1Active;
                    const canEditL2Notes = isL2Active || isL1Active;
                    const canEditL1Notes = isL1Active;

                    let attachmentsHTML = '';
                    if (metric.attachments.length === 0) {
                        attachmentsHTML = `<div class="text-center py-8 text-xs font-medium text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50">No evidence attached</div>`;
                    } else {
                        attachmentsHTML = `<div class="space-y-2">`;
                        metric.attachments.forEach((file, idx) => {
                            attachmentsHTML += `
                                <div class="flex items-center justify-between p-3 border border-slate-200 rounded-xl bg-white shadow-sm">
                                    <div class="flex items-center gap-3 overflow-hidden">
                                        <div class="w-8 h-8 rounded-md bg-blue-50 text-blue-500 flex items-center justify-center shrink-0"><i class="fa-solid fa-file-lines text-xs"></i></div>
                                        <div class="truncate">
                                            <div class="text-xs font-bold text-slate-700 truncate">${file.name}</div>
                                            <div class="text-[10px] text-slate-400">${file.size}</div>
                                        </div>
                                    </div>
                                    ${canEditResponses ? `<button onclick="removeAttachment(${metric.id}, ${idx})" class="text-slate-300 hover:text-red-500 p-2 shrink-0"><i class="fa-solid fa-xmark"></i></button>` : ''}
                                </div>`;
                        });
                        attachmentsHTML += `</div>`;
                    }

                    html += `
                        <div class="bg-white border border-slate-200 rounded-2xl p-7 shadow-soft animate-in fade-in slide-in-from-bottom-4 duration-500">
                            <!-- Header -->
                            <div class="flex items-start gap-4 mb-6 border-b border-slate-100 pb-5">
                                <div class="w-12 h-12 rounded-xl bg-brand-50 text-brand-600 flex items-center justify-center text-xl shrink-0"><i class="fa-solid ${metric.icon}"></i></div>
                                <div>
                                    <span class="text-[10px] font-extrabold text-brand-500 uppercase tracking-widest">${metric.focusArea}</span>
                                    <h3 class="text-lg font-bold text-slate-900 leading-tight mt-1">${metric.metric}</h3>
                                    <p class="text-sm text-slate-500 font-medium mt-1">${metric.question}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                                <!-- Data Entry -->
                                <div class="lg:col-span-3 space-y-5">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-700 mb-2">Vendor Response (${metric.measure})</label>
                                        <input type="text" 
                                            onchange="handleMetricChange(${metric.id}, 'response', this.value)"
                                            value="${metric.response}"
                                            ${!canEditResponses ? 'disabled' : ''}
                                            class="w-full text-sm font-medium border border-slate-300 px-4 py-3 rounded-xl focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 disabled:bg-slate-50 disabled:text-slate-500 transition-all shadow-sm"
                                            placeholder="Enter value..." />
                                    </div>
                                    
                                    <div class="${(!isL3Active && !metric.l3Comment && !canEditL3Notes) ? 'hidden' : 'block'} border-l-2 border-brand-200 pl-4">
                                        <label class="block text-xs font-bold text-slate-700 mb-2">Vendor Context / Notes</label>
                                        <textarea 
                                            onchange="handleMetricChange(${metric.id}, 'l3Comment', this.value)"
                                            ${!canEditL3Notes ? 'disabled' : ''}
                                            class="w-full text-sm font-medium border border-slate-300 px-4 py-3 rounded-xl h-24 resize-none focus:outline-none focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 disabled:bg-slate-50 disabled:text-slate-500 transition-all"
                                            placeholder="Provide additional context to support your response...">${metric.l3Comment}</textarea>
                                    </div>

                                    <div class="${(!isL2Active && !metric.l2Comment && !canEditL2Notes) ? 'hidden' : 'block'} border-l-2 border-blue-400 pl-4 mt-6">
                                        <label class="block text-xs font-bold text-blue-800 mb-2"><i class="fa-solid fa-shield-halved mr-1"></i> Assessor Notes (L2)</label>
                                        <textarea 
                                            onchange="handleMetricChange(${metric.id}, 'l2Comment', this.value)"
                                            ${!canEditL2Notes ? 'disabled' : ''}
                                            class="w-full text-sm font-medium border border-blue-200 bg-blue-50/30 px-4 py-3 rounded-xl h-24 resize-none focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 disabled:bg-transparent disabled:border-transparent disabled:px-0 transition-all"
                                            placeholder="${isL2Active ? 'Add internal audit notes...' : ''}">${metric.l2Comment || ''}</textarea>
                                    </div>
                                    
                                    <div class="${(!isL1Active && !metric.l1Comment && !canEditL1Notes) ? 'hidden' : 'block'} border-l-2 border-purple-400 pl-4 mt-6">
                                        <label class="block text-xs font-bold text-purple-800 mb-2"><i class="fa-solid fa-check-double mr-1"></i> Executive Approval Notes (L1)</label>
                                        <textarea 
                                            onchange="handleMetricChange(${metric.id}, 'l1Comment', this.value)"
                                            ${!canEditL1Notes ? 'disabled' : ''}
                                            class="w-full text-sm font-medium border border-purple-200 bg-purple-50/30 px-4 py-3 rounded-xl h-24 resize-none focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 disabled:bg-transparent disabled:border-transparent disabled:px-0 transition-all"
                                            placeholder="${isL1Active ? 'Add final sign-off notes...' : ''}">${metric.l1Comment || ''}</textarea>
                                    </div>
                                </div>

                                <!-- Attachments -->
                                <div class="lg:col-span-2 bg-slate-50/50 rounded-xl p-5 border border-slate-100">
                                    <div class="flex justify-between items-center mb-4">
                                        <label class="text-xs font-bold text-slate-700">Supporting Evidence</label>
                                        ${canEditResponses ? `
                                            <label class="cursor-pointer text-xs font-bold text-brand-600 hover:text-brand-800 transition-colors bg-brand-50 px-2.5 py-1 rounded-md">
                                                <i class="fa-solid fa-plus mr-1"></i> Add File
                                                <input type="file" class="hidden" onchange="handleFileUpload(event, ${metric.id})" />
                                            </label>
                                        ` : ''}
                                    </div>
                                    ${attachmentsHTML}
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
                contentContainer.innerHTML = html;

            } else if (state.currentStep === 3) {
                let messageHTML = '';
                let actionsHTML = '';
                
                if (isL3Active) {
                    messageHTML = `<p class="text-slate-600 font-medium">As the <strong>Vendor Representative</strong>, please review all provided data and uploaded evidence. Once submitted, the assessment will be locked and sent to the NSW Government Procurement team for review.</p>`;
                    actionsHTML = `
                        <button onclick="handleWorkflowAction('submit_l2')" class="w-full py-4 px-6 text-white font-bold rounded-xl shadow-lg shadow-brand-500/30 hover:-translate-y-1 transition-all flex items-center justify-center gap-3 bg-gradient-to-r from-brand-900 to-brand-500 text-lg">
                            Sign & Submit Assessment <i class="fa-solid fa-paper-plane"></i>
                        </button>`;
                } else if (isL2Active) {
                    messageHTML = `<p class="text-slate-600 font-medium">As the <strong>Internal Assessor (L2)</strong>, review the vendor's inputs. Add audit notes to the metrics. You can approve this to move to Executive Sign-off, or return it to the vendor if data is missing.</p>`;
                    actionsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="handleWorkflowAction('return_l3')" class="w-full py-3.5 px-4 bg-white border-2 border-orange-200 text-orange-600 hover:bg-orange-50 font-bold rounded-xl transition-colors flex items-center justify-center gap-2">
                                <i class="fa-solid fa-rotate-left"></i> Return to Vendor
                            </button>
                            <button onclick="handleWorkflowAction('approve_l1')" class="w-full py-3.5 px-4 text-white font-bold rounded-xl shadow-md bg-blue-600 hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                                Recommend Approval (Send to L1) <i class="fa-solid fa-arrow-right"></i>
                            </button>
                        </div>`;
                } else if (isL1Active) {
                    messageHTML = `<p class="text-slate-600 font-medium">As the <strong>Chief Procurement Officer (L1)</strong>, provide final authorization for this vendor assessment. This action marks the vendor as fully compliant in the system.</p>`;
                    actionsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="handleWorkflowAction('return_l2')" class="w-full py-3.5 px-4 bg-white border-2 border-slate-200 text-slate-600 hover:bg-slate-50 font-bold rounded-xl transition-colors flex items-center justify-center gap-2">
                                <i class="fa-solid fa-rotate-left"></i> Return to Assessor
                            </button>
                            <button onclick="handleWorkflowAction('finalize')" class="w-full py-3.5 px-4 bg-green-600 text-white font-bold rounded-xl shadow-md hover:bg-green-700 transition-colors flex items-center justify-center gap-2">
                                <i class="fa-solid fa-check-double"></i> Authorize & Mark Compliant
                            </button>
                        </div>`;
                } else {
                    messageHTML = `
                        <div class="flex items-center gap-4 bg-green-50 border border-green-200 p-4 rounded-xl">
                            <div class="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xl shrink-0"><i class="fa-solid fa-check"></i></div>
                            <div>
                                <h4 class="font-bold text-green-800">No Action Required</h4>
                                <p class="text-sm text-green-700 mt-1">This submission is currently assigned to another workflow tier or has been fully finalized.</p>
                            </div>
                        </div>`;
                }

                contentContainer.innerHTML = `
                    <div class="bg-white border border-slate-200 rounded-2xl p-8 shadow-soft animate-in fade-in duration-500 max-w-3xl">
                        <div class="mb-8 border-b border-slate-100 pb-6">
                            <h2 class="text-2xl font-bold text-slate-900">Workflow & Authorization</h2>
                            <p class="text-slate-500 text-sm mt-1">Finalize your review and route the assessment.</p>
                        </div>
                        
                        <div class="p-6 border border-brand-100 bg-brand-50/30 rounded-xl mb-8">
                            <h3 class="text-sm font-extrabold text-brand-900 uppercase tracking-widest mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-circle-info"></i> Required Action
                            </h3>
                            ${messageHTML}
                        </div>
                        ${actionsHTML}
                    </div>
                `;
            }
        }

        window.onload = render;
    </script>
</body>
</html>
